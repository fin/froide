!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.publicbody=t():(e.Froide=e.Froide||{},e.Froide.components=e.Froide.components||{},e.Froide.components.publicbody=t())}(window,function(){return function(e){function t(t){for(var r,c,o=t[0],u=t[1],a=t[2],f=0,d=[];f<o.length;f++)c=o[f],s[c]&&d.push(s[c][0]),s[c]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);d.length;)d.shift()();return i.push.apply(i,a||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,o=1;o<n.length;o++){var u=n[o];0!==s[u]&&(r=!1)}r&&(i.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},s={4:0},i=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(){return Promise.resolve()},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var o=window.webpackJsonp=window.webpackJsonp||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var a=0;a<o.length;a++)t(o[a]);var l=u;return i.push([54,0]),n()}([function(e,t,n){"use strict";n.d(t,"g",function(){return r}),n.d(t,"l",function(){return s}),n.d(t,"o",function(){return i}),n.d(t,"n",function(){return c}),n.d(t,"m",function(){return o}),n.d(t,"i",function(){return u}),n.d(t,"j",function(){return a}),n.d(t,"a",function(){return l}),n.d(t,"f",function(){return f}),n.d(t,"d",function(){return d}),n.d(t,"h",function(){return p}),n.d(t,"c",function(){return h}),n.d(t,"b",function(){return b}),n.d(t,"x",function(){return v}),n.d(t,"k",function(){return y}),n.d(t,"e",function(){return g}),n.d(t,"z",function(){return m}),n.d(t,"s",function(){return S}),n.d(t,"v",function(){return P}),n.d(t,"p",function(){return B}),n.d(t,"u",function(){return _}),n.d(t,"w",function(){return O}),n.d(t,"t",function(){return R}),n.d(t,"r",function(){return w}),n.d(t,"y",function(){return E}),n.d(t,"A",function(){return j}),n.d(t,"q",function(){return C});var r="SET_CONFIG",s="SET_STEP",i="SET_STEP_SELECT_PUBLICBODY",c="SET_STEP_REVIEW_PUBLICBODY",o="SET_STEP_REQUEST",u="SET_PUBLICBODY",a="SET_PUBLICBODY_ID",l="ADD_PUBLICBODY_ID",f="REMOVE_PUBLICBODY_ID",d="CLEAR_PUBLICBODIES",p="SET_PUBLICBODIES",h="CACHE_PUBLICBODIES",b="CACHE_LAWS",v="UPDATE_LAW_TYPE",y="SET_SEARCHRESULTS",g="CLEAR_SEARCHRESULTS",m="UPDATE_SUBJECT",S="UPDATE_BODY",P="UPDATE_FULL_TEXT",B="SET_USER",_="UPDATE_FIRST_NAME",O="UPDATE_LAST_NAME",R="UPDATE_EMAIL",w="UPDATE_ADDRESS",E="UPDATE_PRIVATE",j="UPDATE_USER_ID",C={SELECT_PUBLICBODY:1,REVIEW_PUBLICBODY:2,WRITE_REQUEST:3}},,,,function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=new RegExp(/\$\{(\w+)\}/g),i=document.querySelector("html").lang,c={computed:{i18n:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){r(e,t,n[t])})}return e}({_replacer:function(e){return function(t,n,r,s){return"count"===n&&e.count>=1e3?e.count.toLocaleString(i):e[n]}},_:function(e,t){var n=this[e];return Array.isArray(n)?void 0!==t.count&&(t.count>1||0===t.count)?n[1].replace(s,this._replacer(t)):n[0].replace(s,this._replacer(t)):n.replace(s,this._replacer(t))}},this.config.i18n)}}};t.a=c},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return i}),n.d(t,"d",function(){return c}),n.d(t,"c",function(){return o}),n.d(t,"b",function(){return u});var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"getJson",value:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){if(r.status>=400)try{return n(JSON.parse(r.responseText))}catch(e){return n(r.responseText)}t(JSON.parse(r.responseText))},r.onerror=function(){n(r.statusText)},r.send()})}},{key:"getObjects",value:function(e){return new Promise(function(t,n){e.then(function(e){return t(e.objects)}).catch(function(e){return n(e)})})}},{key:"getJsonObjects",value:function(e){var t=this;return new Promise(function(n,r){t.getJson(e).then(function(e){return n(e.objects)}).catch(function(e){return r(e)})})}},{key:"getPublicBody",value:function(e){var t=this.config.url.getPublicBody.replace(/\/0\//,"/".concat(e,"/"));return this.getJson(t)}},{key:"autocompletePublicBody",value:function(e){var t=encodeURIComponent(e),n=this.config.url.autocompletePublicBody+"?query="+t;return this.getJsonObjects(n)}},{key:"getUser",value:function(){return this.getJson(this.config.url.user)}},{key:"getJsonForUrl",value:function(e,t,n){var r=!1;return void 0!==t&&t&&(r=!0,e=e+"?q="+encodeURIComponent(t)),void 0!==n&&function(){var t=[],s=function(e){var r=n[e];null!==r&&(Array.isArray(r)||(r=[r]),r.forEach(function(n){t.push(e+"="+encodeURIComponent(n))}))};for(var i in n)s(i);e+=r?"&":"?",e+=t.join("&")}(),this.getJson(e)}},{key:"searchPublicBodies",value:function(e,t){return this.getJsonForUrl(this.config.url.searchPublicBody,e,t)}},{key:"listPublicBodies",value:function(e,t){return this.getJsonForUrl(this.config.url.listPublicBodies,e,t)}},{key:"getLawsForPublicBodies",value:function(e,t){t=t||{};var n={},r=[];return e.forEach(function(e){e.laws.forEach(function(e){if("string"==typeof e){if(void 0!==t[e])return;var s=e.split("/"),i=s[s.length-2];void 0===n[i]&&(n[i]=!0,r.push(i))}})}),0===r.length?Promise.resolve([]):this.getJsonForUrl(this.config.url.listLaws,null,{id:r.join(",")}).then(function(e){return e.objects})}},{key:"listJurisdictions",value:function(e,t){return this.getJsonForUrl(this.config.url.listJurisdictions,e,t)}},{key:"listCategories",value:function(e,t){return this.getJsonForUrl(this.config.url.listCategories,e,t)}},{key:"listClassifications",value:function(e,t){return this.getJsonForUrl(this.config.url.listClassifications,e,t)}},{key:"searchFoiRequests",value:function(e){var t=encodeURIComponent(e),n=this.config.url.searchRequests+"?q="+t;return this.getJsonObjects(n)}}]),e}();function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return window.fetch(e,{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":n},body:JSON.stringify(t)}).then(function(e){return e.json()})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=t||{},window.fetch(e,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){r(e,t,n[t])})}return e}({Accept:"application/json","X-Requested-With":"XMLHttpRequest"},t)}).then(function(e){return e.json()})}function u(e){return window.fetch(e,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{pragma:"no-cache","cache-control":"no-cache"}})}},function(e,t,n){"use strict";var r=n(3),s=n(0);function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o={computed:i({publicBody:function(){return this.getPublicBodyByScope(this.scope)},publicBodies:function(){return this.getPublicBodiesByScope(this.scope)},hasPublicBodies:function(){return this.publicBodies.length>0},searchResults:function(){return this.getScopedSearchResults(this.scope)},hasSearchResults:function(){return this.searchResults.length>0},hasNextSearchResults:function(){var e=this.getScopedSearchMeta(this.scope);return!!e&&e.next},hasPreviousSearchResults:function(){var e=this.getScopedSearchMeta(this.scope);return!!e&&e.previous},currentResultPage:function(){var e=this.getScopedSearchMeta(this.scope);return e?e.offset/e.limit+1:0},maxResultPage:function(){var e=this.getScopedSearchMeta(this.scope);return e?Math.ceil(e.total_count/e.limit):0},currentResultsLength:function(){var e=this.searchResults;return e?e.length:null},searchResultsLength:function(){var e=this.getScopedSearchMeta(this.scope);return e?e.total_count:0},emptyResults:function(){var e=this.searchResultsLength;return null!==e&&0===e}},Object(r.c)(["getPublicBody","getPublicBodyByScope","getPublicBodiesByScope","getScopedSearchResults","getScopedSearchMeta"])),methods:i({getNext:function(e){this.getNextSearchResults(this.scope)},getPrevious:function(e){this.getPreviousSearchResults(this.scope)}},Object(r.d)({setPublicBody:s.i,clearSearchResults:s.e}),Object(r.b)(["getNextSearchResults","getPreviousSearchResults"]))};t.a=o},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return e.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}function i(e,t){return function(){return t(e.tag,{domProps:{innerHTML:e.innerHTML}})}}function c(e,t){"string"==typeof e&&(e=document.querySelector(e));var n=function(e){for(var t=e.attributes,n={},r=0;r<t.length;r+=1){var i=t[r];if(("v"!==i.name[0]||"-"!==i.name[1])&&"id"!==i.name&&"class"!==i.name){var c=i.value,o=i.name;":"===i.name[0]&&(o=i.name.substring(1),"{"!==i.value[0]&&"["!==i.value[0]||(c=JSON.parse(i.value)),"true"===i.value&&(c=!0)),n[s(o)]=c}}return n}(e),c=function(e){for(var t=e.querySelectorAll("[slot]"),n={},r=0;r<t.length;r+=1){var s=t[r];n[s.attributes.slot.value]={tag:s.tagName.toLowerCase(),innerHTML:s.innerHTML}}return n}(e),o=function(e){var t={};if(e.id&&(t.attrs={id:e.id}),e.className){var n=e.className.split(" ");t.class={},n.forEach(function(e){t.class[e.trim()]=!0})}return t}(e);return function(e){var s=function(e,t){var n={};for(var r in e)n[r]=i(e[r],t);return n}(c,e);return e(t,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){r(e,t,n[t])})}return e}({props:n,scopedSlots:s},o))}}n.d(t,"a",function(){return c})},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=n(13),s=n.n(r),i=n(3),c=n(0);function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={created:function(){if(this.hasForm&&this.field.value){var e=this.field.objects;e&&(this.cachePublicBodies(e),this.setPublicBodies({publicBodies:e,scope:this.scope}))}},computed:o({help_url:function(){return this.config.url.helpAbout},headers:function(){return[{key:"name",label:this.i18n.name,sortKey:function(e){return e.name}},{key:"jurisdiction",label:this.i18n.jurisdictionPlural[0],sortKey:function(e){return e.jurisdiction.name}},{key:"classification",label:this.i18n.classificationPlural[0],sortKey:function(e){return e.classification&&e.classification.name}},{key:"categories",label:this.i18n.topicPlural[1],sortKey:function(e){return e.categories[0]&&e.categories[0].name}}]},hasForm:function(){return void 0!==this.form&&null!==this.form&&""!==this.form},formFields:function(){return this.form.fields},field:function(){return this.formFields[this.name]},errors:function(){return this.form.errors},hasPublicBodies:function(){return this.publicBodies.length>0},debouncedAutocomplete:function(){return s()(this.runAutocomplete,300)},hasFilters:function(){return!!this.filters&&Object.keys(this.filters).length>0},searchFilters:function(){var e={};if(!this.hasFilters)return e;for(var t in this.filters)null!==this.filters[t]&&0!==this.filters[t].length&&(e[t]=this.filters[t].id);return e},hasSearchResults:function(){return this.searchResults.length>0},searchResults:function(){return this.getScopedSearchResults(this.scope)},searchMeta:function(){return this.getScopedSearchMeta(this.scope)}},Object(i.c)(["getPublicBodyByScope","getScopedSearchResults","getScopedSearchMeta"])),methods:o({buildQuery:function(){var e=this.search;return this.hasFilters&&(e+=JSON.stringify(this.filters)),e},selectAllRows:function(e){var t=this;this.searchResults.forEach(function(n){e?t.addPublicBodyId({publicBodyId:n.id,scope:t.scope}):t.removePublicBodyId({publicBodyId:n.id,scope:t.scope})})},clearSelection:function(){window.confirm(this.i18n.reallyClearSelection)&&(this.clearPublicBodies({scope:this.scope}),this.setStepSelectPublicBody())},triggerAutocomplete:function(){(""!==this.search||this.hasFilters||(this.searching=!1),!this.allowEmptySearch&&void 0!==this.search&&this.search.length<3&&!this.hasFilters)?this.searching=!1:this.buildQuery()!==this.lastQuery||0===this.searchResults.length?(this.searching=!0,this.debouncedAutocomplete()):this.searching=!1},runAutocomplete:function(){var e=this;return this.searching=!0,this.lastQuery=this.buildQuery(),this.getSearchResults({scope:this.scope,search:this.search,filters:this.searchFilters}).then(function(){e.searching=!1})},clearResults:function(){this.clearSearchResults({scope:this.scope})}},Object(i.d)({setPublicBody:c.i,setPublicBodies:c.h,setSearchResults:c.k,cachePublicBodies:c.c,clearPublicBodies:c.d,clearSearchResults:c.e,addPublicBodyId:c.a,setStepSelectPublicBody:c.o,removePublicBodyId:c.f}),Object(i.b)(["getSearchResults"]))};t.a=a},,,function(e,t,n){"use strict";var r=n(3),s=n(6),i=n(4),c={name:"pb-result-list",props:["name","scope","config"],mixins:[s.a,i.a],computed:{value:{get:function(){if(this.publicBody)return this.publicBody.id},set:function(e){this.setPublicBody({publicBody:this.getPublicBody(e),scope:this.scope}),this.clearSearchResults({scope:this.scope})}}},methods:{selectSearchResult:function(e){this.value=e.target.value}}},o=(n(34),n(2)),u=Object(o.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.publicBody&&!e.hasSearchResults?n("div",{staticClass:"search-result"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{type:"radio","data-label":e.publicBody.name,name:e.name},domProps:{value:e.publicBody.id,checked:e._q(e.value,e.publicBody.id)},on:{change:function(t){e.value=e.publicBody.id}}}),e._v("\n      "+e._s(e.publicBody.name)+"\n      "),n("small",[e._v("\n        "+e._s(e.publicBody.jurisdiction.name)+"\n      ")])])]):e._e(),e._v(" "),e.searchResults.length>0||e.emptyResults?n("ul",{staticClass:"search-results list-unstyled"},e._l(e.searchResults,function(t){return n("li",{key:t.id,staticClass:"search-result"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{type:"radio","data-label":t.name,name:e.name},domProps:{value:t.id,checked:e._q(e.value,t.id)},on:{change:[function(n){e.value=t.id},e.selectSearchResult],click:e.selectSearchResult}}),e._v("\n        "+e._s(t.name)+"\n        "),n("small",[e._v("\n          "+e._s(t.jurisdiction.name)+"\n        ")])])])}),0):e._e()])},[],!1,null,"6c190725",null).exports,a=n(0);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f={name:"pb-action-list",mixins:[s.a,i.a],props:["name","scope","config"],methods:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){l(e,t,n[t])})}return e}({selectSearchResult:function(e){this.setPublicBodyId({publicBodyId:e,scope:this.scope}),this.setStepRequest()},getMakeRequestURLForResult:function(e){return this.config.url.makeRequestTo.replace(/0/,e.id)}},Object(r.d)({setStepRequest:a.m,setPublicBodyId:a.j}))},d=(n(35),Object(o.a)(f,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-result-container"},[e.searchResultsLength>0||e.emptyResults?n("ul",{staticClass:"search-results list-unstyled"},e._l(e.searchResults,function(t){return n("li",{key:t.id,staticClass:"search-result",on:{click:function(n){return n.preventDefault(),e.selectSearchResult(t.id)}}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-sm-8"},[n("h4",{staticClass:"pb-heading"},[e._v("\n            "+e._s(t.name)+"\n          ")]),e._v(" "),n("small",[e._v("\n            "+e._s(t.jurisdiction.name)+",\n            "+e._s(e.i18n._("requestCount",{count:t.number_of_requests}))+"\n          ")])]),e._v(" "),n("div",{staticClass:"col-sm-4"},[n("a",{staticClass:"btn btn-primary",attrs:{href:e.getMakeRequestURLForResult(t)},on:{click:function(n){return n.preventDefault(),e.selectSearchResult(t.id)}}},[e._v("\n            "+e._s(e.i18n.makeRequest)+"\n          ")])])])])}),0):e._e(),e._v(" "),e.hasSearchResults&&e.maxResultPage>1?n("ul",{staticClass:"pagination"},[e.hasPreviousSearchResults?n("li",{staticClass:"page-item"},[n("a",{staticClass:"page-link prev",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.getPrevious(t)}}},[n("span",{attrs:{"aria-hidden":"true"}},[e._v("«")]),e._v(" "),n("span",{staticClass:"sr-only"},[e._v(e._s(e.i18n.previous))])])]):n("li",{staticClass:"page-item disabled"},[n("a",{staticClass:"page-link",attrs:{href:"#",tabindex:"-1"}},[n("span",{attrs:{"aria-hidden":"true"}},[e._v("«")]),e._v(" "),n("span",{staticClass:"sr-only"},[e._v(e._s(e.i18n.previous))])])]),e._v(" "),n("li",{staticClass:"page-item disabled"},[n("span",{staticClass:"page-link"},[e._v("\n        "+e._s(e.currentResultPage)+" / "+e._s(e.maxResultPage)+"\n      ")])]),e._v(" "),e.hasNextSearchResults?n("li",{staticClass:"page-item"},[n("a",{staticClass:"page-link next",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.getNext(t)}}},[n("span",{attrs:{"aria-hidden":"true"}},[e._v("»")]),e._v(" "),n("span",{staticClass:"sr-only"},[e._v(e._s(e.i18n.next))])])]):n("li",{staticClass:"page-item disabled"},[n("a",{staticClass:"page-link",attrs:{href:"#",tabindex:"-1"}},[n("span",{staticClass:"sr-only"},[e._v(e._s(e.i18n.next))]),e._v(" "),n("span",{attrs:{"aria-hidden":"true"}},[e._v("»")])])])]):e._e()])},[],!1,null,"3f4a526c",null).exports);function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){h(e,t,n[t])})}return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b={name:"pb-multi-item",props:["name","result","scope"],computed:p({value:{get:function(){return this.isPublicBodySelectedByScope(this.scope,this.result.id)},set:function(e){e?this.addPublicBodyId({publicBodyId:this.result.id,scope:this.scope}):this.removePublicBodyId({publicBodyId:this.result.id,scope:this.scope})}}},Object(r.c)(["isPublicBodySelectedByScope"])),methods:p({selectSearchResult:function(e){this.value=e.target.value}},Object(r.d)({addPublicBodyId:a.a,removePublicBodyId:a.f}))},v=Object(o.a)(b,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{type:"checkbox","data-label":e.result.name,name:e.name},domProps:{value:e.result.id,checked:Array.isArray(e.value)?e._i(e.value,e.result.id)>-1:e.value},on:{change:function(t){var n=e.value,r=t.target,s=!!r.checked;if(Array.isArray(n)){var i=e.result.id,c=e._i(n,i);r.checked?c<0&&(e.value=n.concat([i])):c>-1&&(e.value=n.slice(0,c).concat(n.slice(c+1)))}else e.value=s}}}),e._v("\n  "+e._s(e.result.name)+"\n  "),n("small",[e._v("\n    "+e._s(e.result.jurisdiction.name)+"\n  ")])])},[],!1,null,null,null).exports;function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g={name:"pb-multi-list",props:["name","scope","config"],mixins:[s.a,i.a],methods:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){y(e,t,n[t])})}return e}({selectAll:function(){var e=this;this.searchResults.forEach(function(t){e.addPublicBodyId({publicBodyId:t.id,scope:e.scope})})}},Object(r.d)({setStepRequest:a.m,addPublicBodyId:a.a})),components:{PbMultiItem:v}},m=(n(36),Object(o.a)(g,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.searchResults.length>0||e.emptyResults?n("div",[n("div",[n("a",{directives:[{name:"show",rawName:"v-show",value:e.hasPublicBodies,expression:"hasPublicBodies"}],staticClass:"btn btn-primary",attrs:{href:"#step-request"},on:{click:e.setStepRequest}},[e._v("\n        Continue\n      ")]),e._v(" "),e.hasSearchResults?n("a",{staticClass:"btn btn-light pull-right",attrs:{href:"#"},on:{click:e.selectAll}},[e._v("\n        Select all\n      ")]):e._e()]),e._v(" "),n("ul",{staticClass:"search-results list-unstyled"},e._l(e.searchResults,function(t){return n("li",{key:t.id,staticClass:"search-result"},[n("pb-multi-item",{attrs:{name:e.name,result:t,scope:e.scope}})],1)}),0),e._v(" "),e.hasPublicBodies?n("p",[n("a",{staticClass:"btn btn-primary",attrs:{href:"#step-request"},on:{click:e.setStepRequest}},[e._v("\n        Continue\n      ")])]):e._e()]):e._e()])},[],!1,null,"481e67b6",null).exports);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P={name:"publicbody-chooser",mixins:[n(11).a,i.a],props:["name","scope","defaultsearch","form","config","listView"],data:function(){return{search:this.defaultsearch,lastQuery:null,emptyResults:!1,searching:!1}},created:function(){this.setConfig(this.config)},mounted:function(){this.defaultsearch&&null===this.searchMeta&&this.triggerAutocomplete()},components:{resultList:u,actionList:d,multi:m},computed:{getListView:function(){return this.listView?this.listView:"resultList"},label:function(){if(this.publicBody)return this.publicBody.name},publicBody:function(){return this.getPublicBodyByScope(this.scope)}},methods:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}({},Object(r.d)({setConfig:a.g}))},B=Object(o.a)(P,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"publicbody-chooser mb-3"},[n("div",{staticClass:"form-search"},[n("div",{staticClass:"input-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"search-public_bodies form-control",attrs:{type:"search",placeholder:e.i18n.publicBodySearchPlaceholder},domProps:{value:e.search},on:{keyup:e.triggerAutocomplete,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.triggerAutocomplete(t))},input:function(t){t.target.composing||(e.search=t.target.value)}}}),e._v(" "),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary search-public_bodies-submit",attrs:{type:"button"},on:{click:e.triggerAutocomplete}},[n("i",{staticClass:"fa fa-search"}),e._v("\n          "+e._s(e.i18n.search)+"\n        ")])])])]),e._v(" "),e.searching?n("div",{staticClass:"search-spinner"},[n("img",{attrs:{src:e.config.resources.spinner,alt:"Loading..."}})]):e._e(),e._v(" "),n(e.getListView,{tag:"component",attrs:{name:e.name,scope:e.scope,config:e.config}})],1)},[],!1,null,null,null);t.a=B.exports},function(e,t,n){"use strict";var r=n(1),s=n(3),i=n(0),c=n(5);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u,a=function(e,t){return e.meta&&t.meta?0:e.meta?-1:t.meta?1:0},l=function(e,t){if(0===e.length)return null;var n=e.filter(function(e){return!t||-1!==e.law_type.indexOf(t)});return 0===n.length&&(n=o(e)),(n=n.sort(a))[0]};function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r.a.use(s.a);t.a=new s.a.Store({state:{config:null,scopedSearchResults:{},scopedSearchFacets:{},scopedSearchMeta:{},scopedPublicBodies:{},scopedPublicBodiesMap:{},lawCache:{},publicBodies:{},lawType:null,user:{},step:i.q.SELECT_PUBLICBODY,subject:"",body:"",fullText:!1},getters:{getPublicBodyByScope:function(e,t){return function(e){var n=t.getPublicBodiesByScope(e);return 0===n.length?null:n[0]}},getPublicBodiesByScope:function(e,t){return function(t){var n=e.scopedPublicBodies[t];return void 0===n?[]:n}},isPublicBodySelectedByScope:function(e){return function(t,n){var r=e.scopedPublicBodiesMap[t];return void 0!==r&&void 0!==r[n]}},getPublicBody:function(e){return function(t){return e.publicBodies[t]}},getScopedSearchResults:function(e,t){return function(t){var n=e.scopedSearchResults[t];return void 0===n?[]:n}},getScopedSearchFacets:function(e){return function(t){var n=e.scopedSearchFacets[t];return void 0===n?null:n}},getScopedSearchMeta:function(e){return function(t){var n=e.scopedSearchMeta[t];return void 0===n?null:n}},getLawsForPublicBody:function(e){return function(t){return t.laws.map(function(t){return e.lawCache[t]}).filter(function(e){return void 0!==e})}},defaultLaw:function(e,t){var n=null;for(n in e.scopedPublicBodies);for(var r=e.scopedPublicBodies[n],s=null,i=!0,c=0;c<r.length;c+=1){var o=r[c],u=t.getLawsForPublicBody(o),a=l(u,e.lawType);if(null!==a)if(0!==c){if(s.id!==a.id){i=!1;break}s=a}else s=a}return i?s:null},user:function(e){return e.user},subject:function(e){return e.subject},getSubject:function(e){return function(){return e.subject}},body:function(e){return e.body},fullText:function(e){return e.fullText},stepSelectPublicBody:function(e){return e.step===i.q.SELECT_PUBLICBODY},stepSelectPublicBodyDone:function(e){return e.step>i.q.SELECT_PUBLICBODY},stepReviewPublicBodies:function(e){return e.step===i.q.REVIEW_PUBLICBODY},stepReviewPublicBodiesDone:function(e){return e.step>i.q.REVIEW_PUBLICBODY},stepWriteRequest:function(e){return e.step===i.q.WRITE_REQUEST},stepWriteRequestDone:function(e){return e.step>i.q.WRITE_REQUEST},step:function(e){return e.step},lawType:function(e){return e.lawType}},mutations:(u={},d(u,i.g,function(e,t){null!==e.config&&void 0!==e.config||(e.config=t)}),d(u,i.l,function(e,t){e.step=t}),d(u,i.o,function(e){e.step=i.q.SELECT_PUBLICBODY}),d(u,i.n,function(e){e.step=i.q.REVIEW_PUBLICBODY}),d(u,i.m,function(e){e.step=i.q.WRITE_REQUEST}),d(u,i.i,function(e,t){var n=t.publicBody,s=t.scope;r.a.set(e.scopedPublicBodies,s,[n]),r.a.set(e.scopedPublicBodiesMap,s,d({},n.id,!0)),e.scopedSearchResults[s].forEach(function(e){e.id===n.id?e.isSelected=!0:e.isSelected=!1})}),d(u,i.h,function(e,t){var n=t.publicBodies,s=t.scope;r.a.set(e.scopedPublicBodies,s,n);var i={};n.forEach(function(e){i[e.id]=!0}),r.a.set(e.scopedPublicBodiesMap,s,i),e.scopedSearchResults[s]&&e.scopedSearchResults[s].forEach(function(e){void 0!==i[e.id]?e.isSelected=!0:e.isSelected=!1})}),d(u,i.j,function(e,t){var n=t.publicBodyId,s=t.scope,i=e.publicBodies[n];r.a.set(e.scopedPublicBodies,s,[i]),r.a.set(e.scopedPublicBodiesMap,s,{publicBodyId:!0}),e.scopedSearchResults[s]&&e.scopedSearchResults[s].forEach(function(e){e.id===n?e.isSelected=!0:e.isSelected=!1})}),d(u,i.a,function(e,t){var n=t.publicBodyId,s=t.scope,i=e.publicBodies[n];if(void 0!==i){var c=e.scopedPublicBodies[s];if(void 0===c)r.a.set(e.scopedPublicBodies,s,[i]);else c.some(function(e){return e.id===i.id})||r.a.set(e.scopedPublicBodies,s,[].concat(f(c),[i]));r.a.set(e.scopedPublicBodiesMap[s],n,!0),e.scopedSearchResults[s]&&e.scopedSearchResults[s].forEach(function(e){e.id===n&&(e.isSelected=!0)})}}),d(u,i.f,function(e,t){var n=t.publicBodyId,s=t.scope,i=e.scopedPublicBodies[s];void 0!==i&&(i=i.filter(function(e){return e.id!==n}),r.a.set(e.scopedPublicBodies,s,i),r.a.set(e.scopedPublicBodiesMap[s],n,void 0),e.scopedSearchResults[s]&&e.scopedSearchResults[s].forEach(function(e){e.id===n&&(e.isSelected=!1)}))}),d(u,i.d,function(e,t){var n=t.scope;r.a.set(e.scopedPublicBodies,n,[]),r.a.set(e.scopedPublicBodiesMap,n,{}),e.scopedSearchResults[n]&&e.scopedSearchResults[n].forEach(function(e){e.isSelected=!1})}),d(u,i.c,function(e,t){var n={};t&&(t.forEach(function(e){n[e.id]=e}),e.publicBodies=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}({},e.publicBodies,n))}),d(u,i.k,function(e,t){var n=t.searchResults,s=t.searchFacets,i=t.searchMeta,c=t.scope;e.scopedPublicBodiesMap[c]=e.scopedPublicBodiesMap[c]||{},n=n.map(function(t){return t.isSelected=void 0!==e.scopedPublicBodiesMap[c][t.id],t}),r.a.set(e.scopedSearchResults,c,n),r.a.set(e.scopedSearchFacets,c,s),r.a.set(e.scopedSearchMeta,c,i)}),d(u,i.e,function(e,t){var n=t.scope;r.a.set(e.scopedSearchResults,n,[]),r.a.set(e.scopedSearchFacets,n,{}),r.a.set(e.scopedSearchMeta,n,null)}),d(u,i.v,function(e,t){e.fullText=t}),d(u,i.p,function(e,t){e.user=t}),d(u,i.z,function(e,t){e.subject=t}),d(u,i.s,function(e,t){e.body=t}),d(u,i.u,function(e,t){r.a.set(e.user,"first_name",t)}),d(u,i.w,function(e,t){r.a.set(e.user,"last_name",t)}),d(u,i.r,function(e,t){r.a.set(e.user,"address",t)}),d(u,i.t,function(e,t){r.a.set(e.user,"email",t)}),d(u,i.y,function(e,t){r.a.set(e.user,"private",t)}),d(u,i.A,function(e,t){r.a.set(e.user,"id",t)}),d(u,i.x,function(e,t){e.lawType=t}),d(u,i.b,function(e,t){t.laws.forEach(function(t){r.a.set(e.lawCache,t.resource_uri,t)})}),u),actions:{setSearchResults:function(e,t){var n=e.commit,r=(e.state,e.dispatch),s=t.scope,c=t.results;n(i.k,{searchResults:c.objects.results,searchFacets:c.objects.facets.fields,searchMeta:c.meta,scope:s}),n(i.c,c.objects.results),r("getLawsForPublicBodies",c.objects.results)},cacheLaws:function(e,t){var n=e.commit,r=t.laws;n(i.b,{laws:r})},getLawsForPublicBodies:function(e,t){var n=e.state,r=e.dispatch;new c.a(n.config).getLawsForPublicBodies(t,n.lawCache).then(function(e){r("cacheLaws",{laws:e})})},getSearchResults:function(e,t){var n=e.commit,r=e.state,s=e.dispatch,o=t.scope,u=t.search,a=t.filters;return n(i.e,{scope:o}),new c.a(r.config).searchPublicBodies(u,a).then(function(e){s("setSearchResults",{results:e,scope:o})})},setPublicBodyById:function(e,t){var n=e.state,r=e.dispatch,s=t.scope,i=t.id;return new c.a(n.config).getPublicBody(i).then(function(e){r("setPublicBodyByIdDone",{result:e,scope:s,id:i})})},setPublicBodyByIdDone:function(e,t){var n=e.commit,r=e.dispatch,s=t.scope,c=t.result,o=t.id;n(i.c,[c]),n(i.j,{publicBodyId:o,scope:s}),n(i.m),r("getLawsForPublicBodies",[c])},getSearchResultsUrl:function(e,t){var n=e.commit,r=e.state,s=(e.getters,e.dispatch),o=t.scope,u=t.url;return n(i.e,{scope:o}),new c.a(r.config).getJson(u).then(function(e){s("setSearchResults",{results:e,scope:o})})},getNextSearchResults:function(e,t){e.state;var n=e.getters;return(0,e.dispatch)("getSearchResultsUrl",{url:n.getScopedSearchMeta(t).next,scope:t})},getPreviousSearchResults:function(e,t){e.state;var n=e.getters;return(0,e.dispatch)("getSearchResultsUrl",{url:n.getScopedSearchMeta(t).previous,scope:t})}},strict:!1})},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(8);n.n(r).a},function(e,t,n){"use strict";var r=n(9);n.n(r).a},function(e,t,n){"use strict";var r=n(10);n.n(r).a},,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(55)},function(e,t,n){"use strict";n.r(t);var r=n(1),s=n(15),i=n(0),c=n(7),o=n(14);function u(e){s.a.commit(i.g),new r.a({store:s.a,components:{PublicbodyChooser:o.a},render:Object(c.a)(e,o.a)}).$mount(e)}r.a.config.productionTip=!1;for(var a=document.querySelectorAll(".publicbody-chooser"),l=0;l<a.length;l+=1)u(a[l])}])});
//# sourceMappingURL=publicbody.js.map